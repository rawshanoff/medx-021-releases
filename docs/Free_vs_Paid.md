## MedX — Free Lifetime vs Paid (feature flags)

Этот документ нужен **вам** (как владельцу продукта) и агенту разработки, чтобы:
- понимать, что должно работать **офлайн навсегда**
- понимать, что продаётся как **платные допы** (активация/продление по интернету)
- держать единый список **feature codes**

---

## Принципы

- **Free Lifetime**: должно работать без интернета, локально (PostgreSQL + backend + frontend).
- **Paid**: включается лицензией (feature flags). Если лицензия невалидна/просрочена — функция выключена (**fail-closed**).
- **Интернет** нужен только для:
  - выдачи/продления лицензии (вы можете дать ключ заранее)
  - отправки файлов/сообщений через Telegram (технически Telegram требует интернет)
  - обновлений приложения (Enterprise)

---

## Роли (минимум)

- **owner (владелец/главврач)**: отчёты/контроль, обычно read-only + доступ к “результатам/файлам”.
- **admin**: пользователи/настройки/всё.
- **receptionist (ресепшн)**: пациенты/очередь/запись.
- **cashier (кассир)**: касса/смены/X-Z/фин отчёты.
- **doctor (врач)**: свои приёмы/очередь/результаты.

---

## Feature codes (единый справочник)

### Free Lifetime (ядро)
- **`core`** — ядро системы (пациенты, врачи/кабинеты/услуги, очередь/визиты, базовая запись)
- **`finance_basic`** — базовая касса: оплаты нал/карта, операции, смены, X/Z (если вы хотите включить в core — можно, но лучше держать флагом)
- **`reports_basic`** — базовые отчёты (день/смена/по врачу/по услуге)

### Paid (допы)
- **`files_results`** — хранение файлов результатов/УЗИ/анализов (локально)
- **`telegram_patient`** — отправка пациентам в Telegram (требует интернет)
- **`tv_queue`** — табло/TV очередь
- **`crm_basic`** — напоминания/простые сегменты пациентов
- **`finance_pro`** — расширенные финансы (зарплаты врачей, расходы, P&L)
- **`cloud_owner`** — удалённый доступ владельца (если будет SaaS/облако)

---

## Матрица Free vs Paid (как продавать)

### Free Lifetime (в подарок клинике)
- `core`
- `finance_basic`
- `reports_basic`

### Пакет “Диагностика + Telegram” (первый платный)
- `files_results`
- `telegram_patient`

### Пакет “Комфорт в холле”
- `tv_queue`

### Пакет “Деньги PRO”
- `finance_pro`

---

## UX правила блокировок (важно для продаж)

- Кнопки платных функций **видны всегда**.
- При попытке использовать платную функцию:
  - если лицензия не активна → показать понятное сообщение (что нужно включить)
  - если нет интернета → показать “для этой функции нужен интернет”
  - если срок истёк → показать дату истечения и кто принимает решение (owner/admin)

