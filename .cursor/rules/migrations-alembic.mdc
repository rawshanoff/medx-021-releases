---
description: Миграции Alembic: один head, политика изменений схемы, релизы
globs: backend/alembic/**/*.py
alwaysApply: false
---

# Alembic / миграции

- **Всегда один head**: перед релизом проверять `alembic heads`.
- **Только forward**: не удаляем колонки “сразу” в Enterprise; используем этапы (добавить → мигрировать данные → использовать → удалить позднее).
- **Без хардкода**: Alembic берёт URL из `DATABASE_URL` и сам конвертирует async→sync.
- **Совместимость**: миграции обязаны проходить на пустой базе и на базе предыдущей версии.
- **Перед upgrade**: бэкап БД обязателен (даже для одной клиники).
